<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GolfStatIQ: Founding Contributor</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111111;
        }
        /* Glassmorphism Effect for the uploader card */
        .glass-card {
            background: rgba(31, 31, 31, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gold-accent { color: #FFD700; }
        .bg-gold-accent { background-color: #FFD700; }
        .dragover {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        /* Style for the progress bar */
        .progress-bar-container {
            height: 6px;
            background-color: #4a5568;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #FFD700;
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="text-white antialiased">

    <div id="main-container" class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8 transition-opacity duration-500">
        <div class="w-full max-w-2xl mx-auto">
            <img src="assets/gsiq_refined_logo_trns.png" alt="GolfStatIQ Logo" class="mx-auto h-36 mb-4">

            <h2 class="text-3xl sm:text-4xl font-bold mb-4 text-center">Become a Founding Contributor</h2>
            <p class="text-gray-300 max-w-xl mx-auto mb-8 text-center">
                Thank you for helping us build the future of golf analytics. By sharing your launch monitor session files, you're providing the essential data needed to make GolfStatIQ the most accurate coaching tool.
            </p>

            <div id="uploader-section" class="glass-card rounded-2xl p-6 sm:p-8 text-left shadow-2xl">
                <h3 class="text-2xl font-semibold text-center mb-6">Secure File Upload</h3>

                <form id="upload-form" novalidate>
                    <div id="drop-zone" class="border-2 border-dashed border-gray-600 rounded-xl p-8 text-center cursor-pointer transition-all duration-300 hover:border-gray-400">
                        <input type="file" id="file-input" multiple class="hidden">
                        <div class="flex flex-col items-center pointer-events-none">
                            <svg class="w-16 h-16 text-gray-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM21 21H3" />
                            </svg>
                            <p class="text-gray-300">Drag & Drop Files Here or <span class="font-semibold gold-accent">Browse Computer</span></p>
                            <p class="text-xs text-gray-500 mt-1">Maximum file size: 10MB</p>
                        </div>
                    </div>

                    <div id="file-list" class="mt-4 space-y-3"></div>
                    <p id="files-error" class="text-red-500 text-sm mt-1 hidden">Please select at least one file.</p>
                    
                    <div class="mt-6">
                        <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Your Email Address (for your free Pro account)</label>
                        <input type="email" name="email" id="email" class="w-full bg-gray-800 border-2 border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-gold-accent focus:ring-1 focus:ring-gold-accent" placeholder="your.email@example.com" required>
                        <p id="email-error" class="text-red-500 text-sm mt-1 hidden">Please enter a valid email address.</p>
                    </div>

                    <div class="mt-8">
                        <button id="submit-button" type="submit" class="w-full bg-gold-accent text-gray-900 font-bold py-4 px-4 rounded-lg text-lg hover:opacity-90 transition-opacity duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            Upload & Claim My Free Account
                        </button>
                        <p id="upload-error" class="text-red-400 text-center text-sm mt-2 hidden"></p>
                    </div>
                </form>

                <p class="text-xs text-gray-500 mt-6 text-center">
                    ðŸ”’ Your data is used for development purposes only and is never shared.
                </p>
            </div>
        </div>
    </div>

    <div id="success-container" class="min-h-screen hidden items-center justify-center p-4 sm:p-6 lg:p-8 transition-opacity duration-500">
        <div class="w-full max-w-md mx-auto text-center">
            <div class="glass-card rounded-2xl p-8 sm:p-12 shadow-2xl">
                <svg class="w-20 h-20 text-green-500 mx-auto mb-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h2 class="text-3xl font-bold mb-4">Success!</h2>
                <p class="text-gray-300 mb-8">
                    Thank you for your contribution. We've added your email to our Founding Contributor list and you'll receive a notification as we get closer to launch.
                </p>
                <a href="#" onclick="window.location.reload()" class="text-gold-accent font-semibold hover:underline">Upload more files</a>
            </div>
        </div>
    </div>

<script>
    // --- DOM Element References ---
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const uploadForm = document.getElementById('upload-form');
    const emailInput = document.getElementById('email');
    const mainContainer = document.getElementById('main-container');
    const successContainer = document.getElementById('success-container');
    const submitButton = document.getElementById('submit-button');
    const emailError = document.getElementById('email-error');
    const filesError = document.getElementById('files-error');
    const uploadError = document.getElementById('upload-error');
    
    // --- State ---
    let selectedFiles = [];
    const MAX_FILE_SIZE = 10 * 1024 * 1024;

    // --- Drag & Drop Event Listeners (Fixed) ---
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
    });

    function handleDrop(e) {
        handleFiles(e.dataTransfer.files);
    }
    
    dropZone.addEventListener('drop', handleDrop, false);
    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

    // --- File Handling Logic ---
    function handleFiles(files) {
        let newFiles = [...files].filter(file => file.size <= MAX_FILE_SIZE);
        selectedFiles.push(...newFiles);
        updateFileList();
        fileInput.value = '';
    }
    
    function updateFileList() {
        fileList.innerHTML = '';
        if (selectedFiles.length > 0) {
            const list = document.createElement('ul');
            list.className = 'space-y-3';
            selectedFiles.forEach((file, index) => {
                const listItem = document.createElement('li');
                listItem.id = `file-item-${index}`;
                listItem.className = 'bg-gray-800 rounded-lg p-3 text-sm';
                listItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center overflow-hidden">
                            <svg class="w-5 h-5 text-gray-400 mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                            <span class="truncate" title="${file.name}">${file.name}</span>
                        </div>
                        <button type="button" class="text-gray-500 hover:text-red-500 transition-colors ml-2" onclick="removeFile(${index})">
                           <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>
                    <div class="progress-bar-container hidden">
                        <div class="progress-bar"></div>
                    </div>
                `;
                list.appendChild(listItem);
            });
            fileList.appendChild(list);
        }
    }

    window.removeFile = function(index) {
        selectedFiles.splice(index, 1);
        updateFileList();
    }

    // --- Upload Logic with Progress ---
    function uploadFile(file, index, email) {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            const formData = new FormData();
            formData.append('email', email);
            formData.append('files', file);

            const fileItem = document.getElementById(`file-item-${index}`);
            const progressBarContainer = fileItem.querySelector('.progress-bar-container');
            const progressBar = fileItem.querySelector('.progress-bar');
            progressBarContainer.classList.remove('hidden');

            xhr.upload.addEventListener('progress', e => {
                if (e.lengthComputable) {
                    const percentComplete = (e.loaded / e.total) * 100;
                    progressBar.style.width = percentComplete + '%';
                }
            });
            
            xhr.addEventListener('load', () => {
                if (xhr.status === 201 || xhr.status === 200) {
                     progressBar.style.backgroundColor = '#22c55e'; // green-500
                    resolve(xhr.response);
                } else {
                    reject(new Error(`Upload failed for ${file.name}`));
                }
            });
            
            xhr.addEventListener('error', () => {
                 progressBar.style.backgroundColor = '#ef4444'; // red-500
                 reject(new Error('Network error during upload.'))
            });

            xhr.open('POST', 'https://golfstatiq-api.onrender.com/api/v1/contribute/upload', true);
            xhr.send(formData);
        });
    }

    uploadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        let isValid = true;
        [emailError, filesError, uploadError].forEach(el => el.classList.add('hidden'));
        if (!emailInput.value || !emailInput.checkValidity()) {
            isValid = false;
            emailError.classList.remove('hidden');
        }
        if (selectedFiles.length === 0) {
             isValid = false;
            filesError.classList.remove('hidden');
        }
        if (!isValid) return;

        submitButton.disabled = true;
        submitButton.textContent = 'Uploading...';
        const email = emailInput.value;
        emailInput.disabled = true;

        const uploadPromises = selectedFiles.map((file, index) => uploadFile(file, index, email));
        
        try {
            await Promise.all(uploadPromises);
            submitButton.textContent = 'Success!';

            setTimeout(() => {
                 mainContainer.classList.add('opacity-0');
                 setTimeout(() => {
                    mainContainer.classList.add('hidden');
                    successContainer.classList.remove('hidden');
                    successContainer.style.display = 'flex';
                    setTimeout(() => successContainer.classList.add('opacity-100'), 50);
                }, 500);
            }, 1000);

        } catch (error) {
            console.error(error);
            uploadError.textContent = 'One or more files failed to upload. Please try again.';
            uploadError.classList.remove('hidden');
            submitButton.disabled = false;
            emailInput.disabled = false;
            submitButton.textContent = 'Upload & Claim My Free Account';
        }
    });
</script>

</body>
</html>